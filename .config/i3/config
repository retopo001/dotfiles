# i3 config - X11/i3 setup
# Full implementation per x11-menu-spec.md

set $mod Mod4
set $term ghostty

# Font
font pango:JetBrainsMono Nerd Font 9

# Tokyo Night colors
set $bg #1a1b26
set $fg #c0caf5
set $border #33ccff
set $inactive #565f89
set $urgent #f7768e

# Window colors
#                       border    bg   text indicator child_border
client.focused          $border   $bg  $fg  $border   $border
client.focused_inactive $inactive $bg  $fg  $inactive $inactive
client.unfocused        $inactive $bg  $fg  $inactive $inactive
client.urgent           $urgent   $bg  $fg  $urgent   $urgent

# Gaps (inner matches outer)
gaps inner 10
gaps outer 10

# Borders
default_border pixel 2
default_floating_border pixel 2
hide_edge_borders none
for_window [class=".*"] border pixel 2

# Mouse
floating_modifier $mod
focus_follows_mouse no
mouse_warping output

# ============================================
# APPLICATION LAUNCHERS
# ============================================

# App launcher (custom launcher for rofi 2.0 compatibility)
bindsym $mod+space exec ~/bin/app-launcher

# Menu
bindsym $mod+Mod1+space exec ~/bin/menu

# Terminal
bindsym $mod+Return exec $term

# Terminal in same directory
bindsym $mod+Shift+Return exec $term --working-directory "$(~/bin/terminal-cwd)"

# Emacs (client connects to daemon, -a "" starts daemon if needed)
bindsym $mod+e exec emacsclient -c -a ""

# File manager
bindsym $mod+Shift+f exec nautilus --new-window

# Browser
bindsym $mod+Shift+b exec google-chrome-stable
bindsym $mod+Shift+Mod1+b exec google-chrome-stable --incognito

# Music (Spotify)
bindsym $mod+Shift+m exec google-chrome-stable --app=https://open.spotify.com

# Editor (Neovim)
bindsym $mod+Shift+n exec $term -e nvim

# Activity (btop)
bindsym $mod+Shift+t exec $term -e btop

# Docker (lazydocker)
bindsym $mod+Shift+d exec $term -e lazydocker

# Signal
bindsym $mod+Shift+g exec signal-desktop

# Obsidian
bindsym $mod+Shift+o exec obsidian

# Typora
bindsym $mod+Shift+w exec typora

# 1Password
bindsym $mod+Shift+slash exec 1password

# ChatGPT
bindsym $mod+Shift+a exec google-chrome-stable --app=https://chatgpt.com

# Grok
bindsym $mod+Shift+Mod1+a exec google-chrome-stable --app=https://grok.com

# YouTube
bindsym $mod+Shift+y exec google-chrome-stable --app=https://youtube.com

# WhatsApp
bindsym $mod+Shift+Mod1+g exec google-chrome-stable --app=https://web.whatsapp.com

# Google Messages
bindsym $mod+Ctrl+Shift+g exec google-chrome-stable --app=https://messages.google.com/web/conversations

# Google Photos
bindsym $mod+Shift+p exec google-chrome-stable --app=https://photos.google.com

# X (Twitter)
bindsym $mod+Shift+x exec google-chrome-stable --app=https://x.com
bindsym $mod+Shift+Mod1+x exec google-chrome-stable --app=https://x.com/compose/post

# ============================================
# WINDOW MANAGEMENT
# ============================================

# Close window
bindsym $mod+w kill

# Close all windows on workspace
bindsym Ctrl+Mod1+Delete [workspace=__focused__] kill

# Fullscreen
bindsym $mod+f fullscreen toggle

# Toggle floating
bindsym $mod+t floating toggle

# Toggle sticky floating (window pop)
bindsym $mod+o exec ~/bin/window-pop

# Toggle split direction
bindsym $mod+j split toggle

# Focus direction (with cursor warp to center)
bindsym $mod+Left exec ~/bin/focus-warp left
bindsym $mod+Right exec ~/bin/focus-warp right
bindsym $mod+Up exec ~/bin/focus-warp up
bindsym $mod+Down exec ~/bin/focus-warp down

# Move window
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Right move right
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Down move down

# Resize window (incremental)
bindsym $mod+equal resize grow width 50 px
bindsym $mod+minus resize shrink width 50 px
bindsym $mod+Shift+equal resize grow height 50 px
bindsym $mod+Shift+minus resize shrink height 50 px

# Resize window (proportional)
bindsym $mod+Ctrl+1 resize set width 10 ppt
bindsym $mod+Ctrl+2 resize set width 20 ppt
bindsym $mod+Ctrl+3 resize set width 33 ppt
bindsym $mod+Ctrl+4 resize set width 40 ppt
bindsym $mod+Ctrl+5 resize set width 50 ppt
bindsym $mod+Ctrl+6 resize set width 60 ppt
bindsym $mod+Ctrl+7 resize set width 66 ppt
bindsym $mod+Ctrl+8 resize set width 80 ppt
bindsym $mod+Ctrl+9 resize set width 90 ppt
bindsym $mod+Ctrl+0 resize set width 100 ppt

# Grouping (tabbed layout)
bindsym $mod+g layout toggle tabbed split

# ============================================
# WORKSPACES
# ============================================

# Switch workspace
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9

# Next/prev workspace
bindsym $mod+Tab workspace next
bindsym $mod+Shift+Tab workspace prev
bindsym $mod+Ctrl+Tab workspace back_and_forth

# Move window to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9

# Move workspace to monitor
bindsym $mod+Shift+Mod1+Left move workspace to output left
bindsym $mod+Shift+Mod1+Right move workspace to output right

# Scratchpad
bindsym $mod+s scratchpad show
bindsym $mod+Mod1+s move scratchpad

# ============================================
# SCREENSHOTS & CAPTURE
# ============================================

# Screenshot with editing
bindsym Print exec ~/bin/screenshot

# Screenshot straight to clipboard
bindsym Shift+Print exec ~/bin/screenshot --clipboard

# Screen recording toggle
bindsym Mod1+Print exec ~/bin/screenrecord

# Color picker
bindsym $mod+Print exec gpick

# Emoji picker
bindsym $mod+period exec rofimoji

# Keystroke display toggle (for demos/learning)
bindsym $mod+F11 exec --no-startup-id pkill screenkey || screenkey --no-systray -s small --opacity 0.8

# ============================================
# CLIPBOARD (Universal - Super+C/X/V)
# ============================================

bindsym $mod+c exec ~/bin/clipboard-copy
bindsym $mod+x exec ~/bin/clipboard-cut
bindsym $mod+v exec ~/bin/clipboard-paste
bindsym $mod+Ctrl+v exec ~/bin/clipboard-panel

# ============================================
# NOTIFICATIONS (dunst)
# ============================================

bindsym $mod+comma exec dunstctl close
bindsym $mod+Shift+comma exec dunstctl close-all
bindsym $mod+Ctrl+comma exec dunstctl set-paused toggle
bindsym $mod+Mod1+comma exec dunstctl history-pop

# ============================================
# SYSTEM
# ============================================

# Lock screen
bindsym $mod+Ctrl+l exec ~/bin/lock-screen

# System menu
bindsym $mod+Escape exec ~/bin/menu --system

# Logout
bindsym $mod+m exec i3-msg exit

# Show keybindings
bindsym $mod+k exec ~/bin/keybindings-display

# Reload/restart
bindsym $mod+Shift+r restart
bindsym $mod+Shift+q reload

# ============================================
# TOGGLES
# ============================================

# Toggle nightlight
bindsym $mod+Ctrl+n exec ~/bin/toggle-nightlight

# Toggle idle lock
bindsym $mod+Ctrl+i exec ~/bin/toggle-idle

# Toggle top bar (polybar)
bindsym $mod+Shift+space exec ~/bin/toggle-topbar

# Toggle transparency (picom)
bindsym $mod+BackSpace exec pkill picom || picom -b

# Next background
bindsym $mod+Ctrl+space exec ~/bin/bg-next

# Theme picker
bindsym $mod+Ctrl+Shift+space exec ~/bin/menu --theme

# ============================================
# MEDIA KEYS
# ============================================

bindsym XF86AudioRaiseVolume exec pamixer -i 5
bindsym XF86AudioLowerVolume exec pamixer -d 5
bindsym XF86AudioMute exec pamixer -t
bindsym XF86AudioMicMute exec pamixer --default-source -t
bindsym XF86AudioPlay exec playerctl play-pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous
bindsym XF86MonBrightnessUp exec brightnessctl s +5%
bindsym XF86MonBrightnessDown exec brightnessctl s 5%-

# Precision controls (Alt+key for 1% increments)
bindsym Mod1+XF86AudioRaiseVolume exec pamixer -i 1
bindsym Mod1+XF86AudioLowerVolume exec pamixer -d 1
bindsym Mod1+XF86MonBrightnessUp exec brightnessctl s +1%
bindsym Mod1+XF86MonBrightnessDown exec brightnessctl s 1%-

# Audio output switch
bindsym $mod+XF86AudioMute exec ~/bin/audio-switch

# ============================================
# VOICE DICTATION (faster-whisper)
# ============================================

bindsym Pause exec ~/bin/dictate

# ============================================
# TUI LAUNCHERS (use ~/bin/tui for window class)
# ============================================

bindsym $mod+Ctrl+t exec ~/bin/tui btop
bindsym $mod+Ctrl+g exec ~/bin/tui lazygit
bindsym $mod+Ctrl+a exec ~/bin/tui pulsemixer
bindsym $mod+Ctrl+b exec ~/bin/tui bluetui
bindsym $mod+Ctrl+w exec ~/bin/tui impala
bindsym $mod+Ctrl+s exec ~/bin/share-menu

# ============================================
# WINDOW RULES
# ============================================

# Steam
for_window [class="^Steam$"] floating enable
for_window [class="^Steam$" title="^Steam$"] resize set 1100 700, move position center
for_window [class="^Steam$" title="Friends List"] resize set 460 800

# 1Password (tiles like other windows)

# Picture-in-Picture
for_window [title="(?i)picture.?in.?picture"] floating enable, sticky enable, resize set 600 338

# Screensaver
for_window [class="org.bw.screensaver"] fullscreen enable, border none

# LocalSend
for_window [class="^localsend_app$"] floating enable

# File dialogs
for_window [window_role="pop-up"] floating enable
for_window [window_role="dialog"] floating enable
for_window [window_type="dialog"] floating enable

# Pavucontrol
for_window [class="Pavucontrol"] floating enable

# Clipboard panel
for_window [class="clipboard-panel"] floating enable, border none, move position mouse

# Somatic attention overlays
for_window [class="somatic-attention"] floating enable, border none, sticky enable
no_focus [class="somatic-attention"]

# Signal
for_window [class="Signal"] floating enable

# ============================================
# BAR (disabled - using polybar)
# ============================================

bar {
    mode invisible
}

# ============================================
# AUTOSTART
# ============================================

# Blank root window (fixes SDDM background persistence)
exec_always --no-startup-id xsetroot -solid "#1a1b26"

# Compositor
exec_always --no-startup-id pkill picom; pidwait -x picom 2>/dev/null; picom -b

# Wallpaper
exec_always --no-startup-id feh --bg-fill ~/.config/wallpaper/current.jpg 2>/dev/null || feh --bg-fill /usr/share/backgrounds/*.jpg 2>/dev/null

# Polybar
exec_always --no-startup-id ~/.config/polybar/launch.sh

# Notifications
exec --no-startup-id dunst

# Clipboard manager
exec --no-startup-id clipmenud

# Clipboard notifications (keyboard copy only, not mouse select)
exec --no-startup-id autocutsel -selection CLIPBOARD -fork
# NOTE: removed "autocutsel -selection PRIMARY" - was auto-copying mouse selections
exec --no-startup-id ~/bin/clipboard-daemon

# Universal mouse button bindings (middle click paste)
exec --no-startup-id xbindkeys

# Emacs daemon - handled by systemd (emacs.service)

# Polkit agent
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# GNOME Keyring (for GNOME apps like Calendar)
exec --no-startup-id gnome-keyring-daemon --start --components=secrets,pkcs11

# Center single windows on wide screens (like Hyprland dwindle)
exec --no-startup-id ~/bin/i3-center-single

# Compose key for emoji/text shortcuts (CapsLock as Compose)
exec_always --no-startup-id setxkbmap -option compose:caps
